{"version":3,"file":"component---src-pages-webhooks-hooks-md-c3a8844516b043400325.js","mappings":"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","sources":["webpack://commerce-extensibility/./src/pages/webhooks/hooks.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport DefaultLayout from \"/home/runner/work/commerce-extensibility/commerce-extensibility/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"configure-hooks\"\n    }}>{`Configure hooks`}</h1>\n    <p>{`A hook defines a request to a remote server. The `}<inlineCode parentName=\"p\">{`hook`}</inlineCode>{` element of the `}<inlineCode parentName=\"p\">{`webhooks.xml`}</inlineCode>{` file describes the communication parameters, including the URL of the remote service to execute, HTTP method, and timeout information. Additional configuration occurs within the `}<inlineCode parentName=\"p\">{`headers`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`fields`}</inlineCode>{` elements. Each individual `}<inlineCode parentName=\"p\">{`header`}</inlineCode>{` element defines an HTTP header key/value pair, while the individual `}<inlineCode parentName=\"p\">{`field`}</inlineCode>{` elements define what data is transmitted to the external server.`}</p>\n    <p>{`The `}<a parentName=\"p\" {...{\n        \"href\": \"xml-schema.md\"\n      }}>{`webhook configuration reference`}</a>{` describes each element in detail.`}</p>\n    <h2 {...{\n      \"id\": \"define-the-connection\"\n    }}>{`Define the connection`}</h2>\n    <p>{`The following hook definition includes the hook name, the destination URL, and timeout information. The `}<inlineCode parentName=\"p\">{`fallbackErrorMessage`}</inlineCode>{` will be written to the error log and can be displayed on the storefront.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<hook name=\"validate_stock\" url=\"{env:APP_VALIDATE_STOCK_URL}/product-validate-stock\"\ntimeout=\"2000\" softTimeout=\"200\" fallbackErrorMessage=\"Can't add the product to the cart right now\">\\`\n`}</code></pre>\n    <p>{`The hook URL is formed by concatenating the `}<inlineCode parentName=\"p\">{`APP_VALIDATE_STOCK_URL`}</inlineCode>{` environment variable and the partial path `}<inlineCode parentName=\"p\">{`/product-validate-stock`}</inlineCode>{`. This practice is useful for developing in different environments, such as those for staging and production, where the hook URLs are different.`}</p>\n    <h2 {...{\n      \"id\": \"define-request-headers\"\n    }}>{`Define request headers`}</h2>\n    <p>{`You will typically need to send authorization tokens and other connection parameters in the headers of your remote request. Secrets and other sensitive data should not be stored in the `}<inlineCode parentName=\"p\">{`webhooks.xml`}</inlineCode>{` file. Instead, use environment or configuration variables to relay this information.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<hook name=\"validate_stock\" url=\"{env:APP_VALIDATE_STOCK_URL}/product-validate-stock\" timeout=\"2000\" softTimeout=\"200\" required=\"true\" fallbackErrorMessage=\"Can't add the product to the cart right now\">\n    <headers>\n        <header name=\"Authorization\">Bearer: {env:APP_VALIDATE_STOCK_AUTHORIZATION_TOKEN}</header>\n        <header name=\"api-key\">{config:path/to/api-key}</header>\n    </headers>\n</hook>\n`}</code></pre>\n    <p>{`This example defines two headers:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Name`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Value`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`Authorization`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`Bearer:`}</inlineCode>{` and the value of the `}<inlineCode parentName=\"td\">{`APP_VALIDATE_STOCK_AUTHORIZATION_TOKEN`}</inlineCode>{` environment variable.`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`api-key`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Value from the Adobe Commerce configuration to the file containing the key (`}<inlineCode parentName=\"td\">{`path/to/api-key`}</inlineCode>{`).`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <h3 {...{\n      \"id\": \"dynamic-header-resolvers\"\n    }}>{`Dynamic header resolvers`}</h3>\n    <p>{`Instead of storing secrets that expire in environment variables, you can create a dynamic header resolver to manage these values. To create your own resolver, define a new class that implements `}<inlineCode parentName=\"p\">{`Magento\\\\AdobeCommerceWebhooks\\\\Model\\\\HeaderResolverInterface`}</inlineCode>{`, as shown below.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-php\"\n      }}>{`<?php\ndeclare(strict_types=1);\n \nnamespace Magento\\\\WebhookModule\\\\Model;\n\n...\n \nclass AddProductToCartResolver implements HeaderResolverInterface\n{\n    public function __construct(\n        private TokenGenerator $tokenGenerator,\n        private CustomConfig $customConfig,\n    ) {\n    }\n \n    /**\n     *  Returns an array of custom headers\n     * \n     * @return array\n     */\n    public function getHeaders(): array\n    {\n        return [\n            'Authorization' => 'Bearer ' . $this->tokenGenerator->getToken(),\n            'Api-key' => $this->customConfig->getApiKey(),\n            'secret-key' => $this->customConfig->getSecretKey(),\n        ];    \n    }\n}\n`}</code></pre>\n    <p>{`Point to the `}<inlineCode parentName=\"p\">{`AddProductToCartResolver`}</inlineCode>{` class in the `}<inlineCode parentName=\"p\">{`header.resolver`}</inlineCode>{` attribute.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<hook name=\"validate_stock\" url=\"{env:APP_VALIDATE_STOCK_URL}/product-validate-stock\" timeout=\"2000\" softTimeout=\"200\" required=\"true\" fallbackErrorMessage=\"Can't add the product to the cart right now\">\n    <headers>\n        <header resolver=\"Magento\\\\WebhookModule\\\\Model\\\\AddProductToCartResolver\" />\n    </headers>\n</hook>\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"define-the-hook-body\"\n    }}>{`Define the hook body`}</h2>\n    <p>{`The payload for a hook can be large, but in many cases you only need to transmit a few fields to perform the desired operation on the remote server.`}</p>\n    <p>{`Defining the hook requires knowledge of the structure of the original event and the requirements of the remote call. You can use the `}<inlineCode parentName=\"p\">{`bin/magento [webhooks:info](commands.md#display-the-payload-of-a-webhook) <webhook-name>`}</inlineCode>{` command to return the default payload of a webhook.`}</p>\n    <p>{`Imagine that the command returned a Commerce webhook with the following structure:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n    \"data\": {\n        \"product\": {\n            \"name\": \"string\",\n            \"sku\": \"string\",\n            \"qty\": \"float\"\n        }\n    }\n}\n`}</code></pre>\n    <p>{`The webhook contains a top-level `}<inlineCode parentName=\"p\">{`data`}</inlineCode>{` object, and a second-level `}<inlineCode parentName=\"p\">{`product`}</inlineCode>{` object with several fields. However, your remote application expects a payload with the following structure:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n    \"product\": {\n        \"name\": \"string\",\n        \"sku\": \"string\",\n        \"quantity\": \"float\"\n    }\n}\n`}</code></pre>\n    <p>{`To transmit this object to the remote application, you will need to remove the `}<inlineCode parentName=\"p\">{`data`}</inlineCode>{` object from the payload and rename `}<inlineCode parentName=\"p\">{`qty`}</inlineCode>{` to `}<inlineCode parentName=\"p\">{`quantity`}</inlineCode>{`. The `}<inlineCode parentName=\"p\">{`source`}</inlineCode>{` configuration attribute specifies the full path of a Commerce webhook field, while the `}<inlineCode parentName=\"p\">{`name`}</inlineCode>{` attribute defines the full path of the field to transmit. If the two values are identical, then you can omit the `}<inlineCode parentName=\"p\">{`source`}</inlineCode>{` attribute.`}</p>\n    <p>{`The following example configures the webhook described above.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<hook name=\"validate_stock\" url=\"https://example.com/product-validate-stock\" timeout=\"2000\" softTimeout=\"200\" required=\"true\" fallbackErrorMessage=\"Can't add the product to the cart right now\">\n    <fields>\n        <field name='product.name' source='data.product.name' />\n        <field name='product.sku' source='data.product.sku' />\n        <field name='product.quantity' source='data.product.qty' />\n    </fields>\n</hook>\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"field-converters\"\n    }}>{`Field converters`}</h3>\n    <p>{`You can implement a converter class to convert a field to a different data type. For example, Commerce stores order IDs as numeric values. If the hook endpoint expects order IDs to be text values, you must convert the numeric value to a string representation before sending the payload.`}</p>\n    <p>{`All converter classes must implement `}<inlineCode parentName=\"p\">{`Magento\\\\AdobeCommerceWebhooks\\\\Model\\\\Filter\\\\Converter\\\\FieldConverterInterface`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<fields>\n    <field name='order.id' source='data.order.id' />\n    <field name='order.status' source='data.order.status' converter=\"Path/To/The/Converter/Class\" />\n</fields>\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"context-fields\"\n    }}>{`Context fields`}</h3>\n    <p>{`You can add to the webhook payload values from the application context:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<fields>\n    <field name=\"customer.entity_id\" source=\"data.customer.entity_id\" />\n    <field name=\"customer.customer_email\" source=\"context_customer_session.get_customer.get_email\" />\n</fields>\n`}</code></pre>\n    <p>{`In this example, the value of `}<inlineCode parentName=\"p\">{`customer.customer_email`}</inlineCode>{` will be set to `}<inlineCode parentName=\"p\">{`Magento\\\\Customer\\\\Model\\\\Session::getCustomer()::getEmail()`}</inlineCode>{`. If the value does not exist or cannot be processed, the appropriate message will be logged, and the hook execution will not be interrupted.`}</p>\n    <p>{`You can also specify the string arguments to use when accessing the application context. Provide these arguments within curly braces and delimit multiple arguments with colons, if applicable. The following example sets `}<inlineCode parentName=\"p\">{`config_value`}</inlineCode>{` to the value of `}<inlineCode parentName=\"p\">{`Magento\\\\Framework\\\\App\\\\Config\\\\ScopeConfigInterface::getValue('value/path', 'default')`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<fields>\n    <field name=\"config_value\" source=\"context_scope_config.get_value{value/path:default}\" />\n</fields>\n`}</code></pre>\n    <p>{`Supported contexts:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Context`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Context class`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`context_checkout_session`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Magento\\\\Checkout\\\\Model\\\\Session`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`context_customer_session`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Magento\\\\Customer\\\\Model\\\\Session`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`context_registry`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Magento\\\\Framework\\\\Registry`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`context_application_state`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Magento\\\\Framework\\\\App\\\\State`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`context_scope_config`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Magento\\\\Framework\\\\App\\\\Config\\\\ScopeConfigInterface`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`context_http_request`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Magento\\\\Framework\\\\App\\\\Request\\\\Http`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`context_staging`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Magento\\\\Staging\\\\Model\\\\VersionManager`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <h2 {...{\n      \"id\": \"clean-the-cache\"\n    }}>{`Clean the cache`}</h2>\n    <p>{`If you are adding webhook functionality to an instance that is in production mode, run the following command to clean the cache and make the webhook available to the system:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`bin/magento cache:clean config\n`}</code></pre>\n    <p>{`If the instance is in developer mode, these configuration changes are detected automatically.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}