"use strict";(self.webpackChunkcommerce_extensibility=self.webpackChunkcommerce_extensibility||[]).push([[8682],{78294:function(e,n,o){o.r(n),o.d(n,{_frontmatter:function(){return s},default:function(){return x}});var t=o(87462),a=o(45987),i=(o(35776),o(3905)),d=o(91515),m=o(96497);o(42225);const r=["components"],s={},l=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.mdx)("div",n)},c=l("CodeBlock"),p=l("InlineAlert"),u={_frontmatter:s},h=d.Z;function x(e){let{components:n}=e,o=(0,a.Z)(e,r);return(0,i.mdx)(h,(0,t.Z)({},u,o,{components:n,mdxType:"MDXLayout"}),(0,i.mdx)(m.Z,{mdxType:"BetaNote"}),(0,i.mdx)("h1",{id:"real-time-integrations"},"Real-time integrations"),(0,i.mdx)("p",null,"The following sections demonstrate all the real-time integrations that Adobe Commerce Extensibility Starter Kit has to offer, including the synchronous web hook action and an example implementation of a webhook."),(0,i.mdx)("h2",{id:"synchronous-webhook-action"},"Synchronous webhook action"),(0,i.mdx)("actions",null),(0,i.mdx)("p",null,"The contents of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"./actions/webhook")," directory expose a webhook that can be invoked synchronously from Commerce to affect the behavior of a particular business flow."),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"./actions/webhook/check-stock")," folder provides a ",(0,i.mdx)("a",{parentName:"p",href:"#webhooks-example"},"reference implementation")," of a synchronous webhook action."),(0,i.mdx)("p",null,"To get the URL of the webhook, run the following command:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},"aio runtime action get webhook/check-stock --url\n")),(0,i.mdx)("p",null,"By default, ",(0,i.mdx)("inlineCode",{parentName:"p"},"synchronous webhook")," actions have the following response:"),(0,i.mdx)(c,{slots:"heading, code",repeat:"2",languages:"JSON, JSON",mdxType:"CodeBlock"}),(0,i.mdx)("h3",{id:"success"},"Success"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"// ./actions/responses.js#webhookSuccessResponse\nreturn {\n  statusCode: 200,\n  body: {\n    op: 'success'\n  }\n}\n")),(0,i.mdx)("h3",{id:"failure"},"Failure"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-js"},"// ./actions/responses.js#webhookSuccessResponse\nreturn {\n  error: {\n    statusCode: 200,\n    body : {\n      op: 'exception'\n      message: 'YOUR ERROR MESSAGE'\n    }\n  }\n}\n")),(0,i.mdx)("h2",{id:"webhooks-example"},"Webhooks example"),(0,i.mdx)("p",null,"The Adobe Commerce Extensibility Starter Kit can use the ",(0,i.mdx)("a",{parentName:"p",href:"../../webhooks/"},"Adobe Commerce webhook module")," to allow intercepting flows in Adobe Commerce."),(0,i.mdx)("p",null,"This reference implementation makes a real-time query to a third-party system to determine whether the product a shopper placed in their cart is in stock."),(0,i.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,i.mdx)("p",null,"If you do not want to implement webhooks, comment out the ",(0,i.mdx)("inlineCode",{parentName:"p"},"webhook")," section of the Starter Kit's ",(0,i.mdx)("inlineCode",{parentName:"p"},"app.config.yaml")," file before running ",(0,i.mdx)("inlineCode",{parentName:"p"},"aio app deploy"),"."),(0,i.mdx)("p",null,"Webhooks are enabled by default. If you initially disabled webhooks, you can reenable them by uncommenting the ",(0,i.mdx)("inlineCode",{parentName:"p"},"webhook")," section of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"app.config.yaml")," file. Additionally, you will need to redeploy the project and repeat the ",(0,i.mdx)("a",{parentName:"p",href:"./index.md#onboarding"},"onboarding process"),"."),(0,i.mdx)("p",null,"The runtime action included is in the Starter Kit package in the following location:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"actions/webhook/check-stock/index.js"))),(0,i.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,i.mdx)("p",null,"You must implement the stock-checking logic on an external service."),(0,i.mdx)("h3",{id:"configure-webhook"},"Configure webhook"),(0,i.mdx)("p",null,"Follow ",(0,i.mdx)("a",{parentName:"p",href:"../../webhooks/admin-configuration.md"},"admin configuration")," to modify your webhook and define the connection between Adobe Commerce and your backoffice system using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"observer.checkout_cart_product_add_before")," method."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "cart_id": "cart id",\n    "items": [\n      {\n        "item_id": 1,\n        "sku": "Product SKU",\n        "qty": "Cart item qty"\n      }\n    ]\n  }\n}\n')),(0,i.mdx)("h3",{id:"validation"},"Validation"),(0,i.mdx)("p",null,"The following parameters are required:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"data")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"data.cart_id")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"data.items"))),(0,i.mdx)("p",null,"Sample validation logic is provided in the following location in the Starter Kit package."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"webhook\\check-stock\\validator.js"))),(0,i.mdx)("p",null,"You can modify this file to add more validations to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"validateData")," method, if necessary."),(0,i.mdx)("h4",{id:"business-logic"},"Business logic"),(0,i.mdx)("p",null,"The example runtime action ",(0,i.mdx)("inlineCode",{parentName:"p"},"webhook\\check-stock\\index.js")," references the ",(0,i.mdx)("inlineCode",{parentName:"p"},"checkAvailableStock()")," method in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"webhook\\check-stock\\stock.js")," file. You must add custom business logic to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"params")," in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"stock.js")," file in order to test authentication with your third-party backoffice system."),(0,i.mdx)("p",null,"You can also add custom responses."),(0,i.mdx)("h3",{id:"modify-env-parameters"},"Modify ",(0,i.mdx)("inlineCode",{parentName:"h3"},".env")," parameters"),(0,i.mdx)("p",null,"You can access any environment parameters from ",(0,i.mdx)("inlineCode",{parentName:"p"},"params"),". Add any required parameters to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"actions/webhook/check-stock/actions.config.yaml")," under ",(0,i.mdx)("inlineCode",{parentName:"p"},"check-stock -> inputs"),":"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-yaml"},"check-stock:\n  function: check-stock/index.js\n  web: 'yes'\n  runtime: nodejs:16\n  inputs:\n    LOG_LEVEL: debug\n    \n    HERE_YOUR_PARAM: $YOUR_CUSTOM_PARAMETER\n    \n  annotations:\n    require-adobe-auth: false\n    final: true\n")),(0,i.mdx)("h3",{id:"responses"},"Responses"),(0,i.mdx)("p",null,"Error response:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-javascript"},"return {   \n  statusCode: 200,\n  body: {\n    op: 'exception',\n    message: 'Error message'\n  }\n}\n")),(0,i.mdx)("p",null,"Success response:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-javascript"},"return {\n  statusCode: 200,\n  body: {\n    op: 'success'\n  }\n}\n")),(0,i.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,i.mdx)("p",null,"These responses are defined in ",(0,i.mdx)("inlineCode",{parentName:"p"},"webhook\\check-stock\\index.js")," and are adapted from the ",(0,i.mdx)("a",{parentName:"p",href:"../../webhooks/responses.md#responses"},"Commerce webhook responses"),". You can modify the response implementation in your code as needed."))}x.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-app-development-starter-kit-webhooks-md-1213ff6e0f021dcee174.js.map