{"version":3,"file":"component---src-pages-webhooks-use-cases-md-9408c069e62caee7dd8c.js","mappings":"kSAMaA,EAAe,CAAC,EACvBC,EAAc,CAClBD,aAAAA,GAEIE,EAAYC,EAAAA,EACH,SAASC,EAAW,GAGhC,IAFDC,EAAU,EAAVA,WACGC,GAAK,YAER,OAAO,SAACJ,GAAS,UAAKD,EAAiBK,EAAK,CAAED,WAAYA,EAAYE,QAAQ,eAG5E,eACE,GAAM,sBAAoB,uBAE5B,wUACA,eACE,GAAM,4BAA0B,6BAElC,gVACA,qBAAK,iBAAMC,WAAW,MAClB,UAAa,iBAAe,mFAGhC,mBAAG,mBAAQA,WAAW,KAAG,mBACzB,mBAAG,uBAAYA,WAAW,KAAG,0DAC7B,mBAAG,mBAAQA,WAAW,KAAG,sBACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBAAe,iEAMhC,mBAAG,mBAAQA,WAAW,KAAG,gCACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBAAc,22BAkB/B,mBAAG,mBAAQA,WAAW,KAAG,yBACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBAAe,uGAQhC,mBAAG,mBAAQA,WAAW,KAAG,4BACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,eAAa,o9DA0D9B,uGACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,eAAa,4KAM9B,eACE,GAAM,wBAAsB,yBAE9B,kHACA,mBAAG,mBAAQA,WAAW,KAAG,cACzB,yGACA,mBAAG,mBAAQA,WAAW,KAAG,sBACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBAAe,6TAahC,mBAAG,mBAAQA,WAAW,KAAG,gCACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBAAc,y3BAkB/B,mBAAG,mBAAQA,WAAW,KAAG,yBACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBAAe,+FAQhC,mBAAG,mBAAQA,WAAW,KAAG,4BACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,eAAa,o1DAuD9B,+IACA,qBAAK,iBAAMA,WAAW,MAClB,UAAa,eAAa,kKAM9B,eACE,GAAM,uBAAqB,wBAE7B,8NACA,mBAAG,mBAAQA,WAAW,KAAG,cACzB,mBAAG,uBAAYA,WAAW,KAAG,+CAC7B,mBAAG,mBAAQA,WAAW,KAAG,sBACzB,oCAAqB,uBAAYA,WAAW,KAAG,6CAA2D,0EAA0E,uBAAYA,WAAW,KAAG,wBAAsC,sCACpP,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBAAe,goEAwEhC,mBAAG,mBAAQA,WAAW,KAAG,gCACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,gBAAc,y1BAmB/B,mBAAG,mBAAQA,WAAW,KAAG,yBACzB,qBAAK,iBAAMA,WAAW,MAClB,UAAa,iBAAe,2HAWpC,CAEAJ,EAAWK,gBAAiB,C","sources":["webpack://commerce-extensibility/./src/pages/webhooks/use-cases.md"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport DefaultLayout from \"/home/runner/work/commerce-extensibility/commerce-extensibility/node_modules/@adobe/gatsby-theme-aio/src/components/MDXFilter/index.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"webhooks-use-cases\"\n    }}>{`Webhooks use cases`}</h1>\n    <p>{`This topic uses common scenarios to describe how to implement webhooks on Adobe Commerce. Each example provides a webhook configuration fragment as well as the default and configured webhook payload. Some examples also include sample code that define the basic logic of an operation in an App Builder app.`}</p>\n    <h2 {...{\n      \"id\": \"discount-code-validation\"\n    }}>{`Discount code validation`}</h2>\n    <p>{`A merchant uses a third-party extension to create and manage discount codes. When a shopper applies a coupon code to their cart, the coupon code must be validated. The Commerce checkout process can continue if the code is valid. Otherwise, the following error message displays on the Payment Method checkout page:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-text\"\n      }}>{`App Builder Webhook Response: The discount code \"<code-value>\" is not valid\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Webhook name:`}</strong></p>\n    <p><inlineCode parentName=\"p\">{`plugin.magento.quote.api.guest_coupon_management.set`}</inlineCode></p>\n    <p><strong parentName=\"p\">{`Default payload:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n    \"cartId\": \"string\",\n    \"couponCode\": \"string\"\n}\n`}</code></pre>\n    <p><strong parentName=\"p\">{`webhook.xml configuration:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<method name=\"plugin.magento.quote.api.guest_coupon_management.set\" type=\"before\">\n    <hooks>\n        <batch>\n            <hook name=\"validate_discount_code\" url=\"{env:APP_BUILDER_URL}/validate-discount-code\" method=\"POST\" timeout=\"5000\" softTimeout=\"1000\" priority=\"300\" required=\"true\" fallbackErrorMessage=\"The discount code can not be validated\">\n                <headers>\n                    <header name=\"x-gw-ims-org-id\">{env:APP_BUILDER_IMS_ORG_ID}</header>\n                    <header name=\"Authorization\">Bearer {env:APP_BUILDER_AUTH_TOKEN}</header>\n                </headers>\n                <fields>\n                    <field name=\"discountCode.cartId\" source=\"cartId\" />\n                    <field name=\"discountCode.couponCode\" source=\"couponCode\" />\n                </fields>\n            </hook>\n        </batch>\n    </hooks>\n</method>\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Configured payload:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n    \"discountCode\": {\n        \"cartId\": \"string\",\n        \"couponCode\": \"string\"\n    }\n}\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Endpoint code example:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`const fetch = require('node-fetch')\nconst { Core } = require('@adobe/aio-sdk')\nconst { errorResponse, getBearerToken, stringParameters, checkMissingRequestInputs } = require('../utils')\n \n// main function that will be executed by Adobe I/O Runtime\nasync function main (params) {\n  // create a Logger\n  const logger = Core.Logger('main', { level: params.LOG_LEVEL || 'info' })\n \n  try {\n    // 'info' is the default level if not set\n    logger.info('Calling the main action')\n \n    // log parameters, only if params.LOG_LEVEL === 'debug'\n    logger.debug(stringParameters(params))\n \n    //check for missing request input parameters and headers\n    const requiredParams = [/* add required params */]\n    const requiredHeaders = ['Authorization']\n    const errorMessage = checkMissingRequestInputs(params, requiredParams, requiredHeaders)\n    if (errorMessage) {\n      // return and log client errors\n      return errorResponse(400, errorMessage, logger)\n    }\n \n    const discountCode = params.discountCode\n    console.log(discountCode)\n \n    // Place the real validation (calling 3rd party endpoints) here.\n    // In this example, we check if the coupon code contains the string \\`test\\`.\n    // If it does, the request is considered invalid.\n\n    const response = {statusCode: 200}\n    if (discountCode && discountCode.couponCode.toLowerCase().includes('test')) {\n      response.body = JSON.stringify({\n          op: \"exception\",\n          message: \\`App Builder Webhook Response: The discount code \"\\${discountCode.couponCode}\" is not valid\\`\n        })\n    } else {\n      response.body = JSON.stringify({\n        op: \"success\"\n      })\n    }\n \n    // log the response status code\n    logger.info(\\`\\${response.statusCode}: successful request\\`)\n    return response\n  } catch (error) {\n    // log any server errors\n    logger.error(error)\n    // return with 500\n    return errorResponse(500, 'server error', logger)\n  }\n}\n\nexports.main = main\n`}</code></pre>\n    <p>{`If validation fails, the runtime AppBuilder action returns an exception message.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`response.body = JSON.stringify({\n    op: \"exception\",\n    message: \\`App Builder Webhook Response: The discount code \"\\${discountCode.couponCode}\" is not valid\\`\n})\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"gift-card-validation\"\n    }}>{`Gift card validation`}</h2>\n    <p>{`In this example, Commerce calls a third-party gift card provider to validate the gift card.`}</p>\n    <p><strong parentName=\"p\">{`Webhook:`}</strong></p>\n    <p>{`plugin.magento.gift_card_account.api.gift_card_account_management.save_by_quote_id`}</p>\n    <p><strong parentName=\"p\">{`Default payload:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n    \"cartId\": null,\n    \"giftCardAccountData\": {\n        \"gift_cards\": \"string[]\",\n        \"gift_cards_amount\": \"float\",\n        \"base_gift_cards_amount\": \"float\",\n        \"gift_cards_amount_used\": \"float\",\n        \"base_gift_cards_amount_used\": \"float\",\n        \"extension_attributes\": []\n    }\n}\n`}</code></pre>\n    <p><strong parentName=\"p\">{`webhook.xml configuration:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<method name=\"plugin.magento.gift_card_account.api.gift_card_account_management.save_by_quote_id\" type=\"before\">\n    <hooks>\n        <batch>\n            <hook name=\"validate_gift_card\" url=\"{env:APP_BUILDER_URL}/validate-gift-card\" method=\"POST\" timeout=\"5000\" softTimeout=\"1000\" required=\"true\" fallbackErrorMessage=\"The gift card cannot be validated\">\n                <headers>\n                    <header name=\"x-gw-ims-org-id\">{env:APP_BUILDER_IMS_ORG_ID}</header>\n                    <header name=\"Authorization\">Bearer {env:APP_BUILDER_AUTH_TOKEN}</header>\n                </headers>\n                <fields>\n                    <field name=\"giftCard.cartId\" source=\"cartId\" />\n                    <field name=\"giftCard.gift_cards\" source=\"giftCardAccountData.gift_cards\" />\n                </fields>\n            </hook>\n        </batch>\n    </hooks>\n</method>\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Configured payload:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n   \"giftCard\" {\n        \"cartId\": null,\n        \"gift_cards\": \"string[]\"\n    }\n}\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Endpoint code example:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`const fetch = require('node-fetch')\nconst { Core } = require('@adobe/aio-sdk')\nconst { errorResponse, getBearerToken, stringParameters, checkMissingRequestInputs } = require('../utils')\n \n// main function that will be executed by Adobe I/O Runtime\nasync function main (params) {\n  // create a Logger\n  const logger = Core.Logger('main', { level: params.LOG_LEVEL || 'info' })\n \n  try {\n    // 'info' is the default level if not set\n    logger.info('Calling the main action')\n \n    // log parameters, only if params.LOG_LEVEL === 'debug'\n    logger.debug(stringParameters(params))\n \n    // check for missing request input parameters and headers\n    const requiredParams = [/* add required params */]\n    const requiredHeaders = ['Authorization']\n    const errorMessage = checkMissingRequestInputs(params, requiredParams, requiredHeaders)\n    if (errorMessage) {\n      // return and log client errors\n      return errorResponse(400, errorMessage, logger)\n    }\n \n    // Place the real validation (calling 3rd party endpoints) here.\n    // In this example, we check if the postal code is larger than 70000.\n    // If it is, the request is considered invalid.\n\n    const response = {statusCode: 200}\n    const address = params.address\n    if (address.postcode > 70000) {\n      response.body = JSON.stringify({\n        op: \"exception\",\n        message: \\`App Builder Webhook Response: The address with postcode  \"\\${address.postcode}\" is not valid\\`,\n        type: \"Magento\\\\\\\\Framework\\\\\\\\Exception\\\\\\\\InputException\"\n      })\n    } else {\n      response.body = JSON.stringify({\n        op: \"success\"\n      })\n    }\n \n    return response\n  } catch (error) {\n    // log any server errors\n    logger.error(error)\n    // return with 500\n    return errorResponse(500, 'server error', logger)\n  }\n}\n \nexports.main = main\n`}</code></pre>\n    <p>{`If validation fails, the runtime AppBuilder action returns an exception message. The message is visible to the customer.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-js\"\n      }}>{`response.body = JSON.stringify({\n    op: \"exception\",\n    message: \\`App Builder Webhook Response: The gift card code \"\\${giftCards[i]}\" is not valid\\`\n})\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"add-product-to-cart\"\n    }}>{`Add product to cart`}</h2>\n    <p>{`When a shopper adds a product to the cart, a third-party inventory management system checks whether the item is in stock. If it is, allow the product to be added. Otherwise, display an error message.`}</p>\n    <p><strong parentName=\"p\">{`Webhook:`}</strong></p>\n    <p><inlineCode parentName=\"p\">{`observer.checkout_cart_product_add_before`}</inlineCode></p>\n    <p><strong parentName=\"p\">{`Default Payload:`}</strong></p>\n    <p>{`The following `}<inlineCode parentName=\"p\">{`observer.checkout_cart_product_add_before`}</inlineCode>{` payload was obtained from the code execution in the application. The `}<inlineCode parentName=\"p\">{`extension_attributes`}</inlineCode>{` section was deleted for brevity.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n    \"subject\": [],\n    \"eventName\": \"checkout_cart_product_add_before\",\n    \"data\": {\n        \"info\": {\n            \"uenc\": \"<value>\",\n            \"product\": \"23\",\n            \"selected_configurable_option\": \"\",\n            \"related_product\": \"\",\n            \"item\": \"23\",\n            \"form_key\": \"<value>\",\n            \"qty\": \"1\"\n        },\n        \"product\": {\n            \"store_id\": \"1\",\n            \"entity_id\": \"23\",\n            \"attribute_set_id\": \"4\",\n            \"type_id\": \"simple\",\n            \"sku\": \"Product 1\",\n            \"has_options\": \"0\",\n            \"required_options\": \"0\",\n            \"created_at\": \"2023-08-22 14:14:20\",\n            \"updated_at\": \"2023-08-22 14:54:44\",\n            \"row_id\": \"23\",\n            \"created_in\": \"1\",\n            \"updated_in\": \"2147483647\",\n            \"name\": \"Product test 22\",\n            \"meta_title\": \"Product 1\",\n            \"meta_description\": \"Product 1 \",\n            \"page_layout\": \"product-full-width\",\n            \"options_container\": \"container2\",\n            \"country_of_manufacture\": \"AM\",\n            \"url_key\": \"product-1\",\n            \"msrp_display_actual_price_type\": \"0\",\n            \"gift_message_available\": \"2\",\n            \"gift_wrapping_available\": \"2\",\n            \"is_returnable\": \"2\",\n            \"status\": \"1\",\n            \"visibility\": \"4\",\n            \"tax_class_id\": \"2\",\n            \"price\": \"123.000000\",\n            \"weight\": \"12.000000\",\n            \"meta_keyword\": \"Product 1\",\n            \"options\": [],\n            \"media_gallery\": {\n                \"images\": [],\n                \"values\": []\n            },\n            \"extension_attributes\": {\n                ...\n            },\n            \"tier_price\": [],\n            \"tier_price_changed\": 0,\n            \"quantity_and_stock_status\": {\n                \"is_in_stock\": true,\n                \"qty\": 1233\n            },\n            \"category_ids\": [\n                \"4\",\n                \"5\",\n                \"2\",\n                \"3\"\n            ],\n            \"is_salable\": 1,\n            \"website_ids\": [\n                \"1\"\n            ]\n        }\n    }\n}\n`}</code></pre>\n    <p><strong parentName=\"p\">{`webhook.xml configuration:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<method name=\"observer.checkout_cart_product_add_before\" type=\"before\">\n    <hooks>\n        <batch>\n            <hook name=\"validate_stock\" url=\"{env:APP_BUILDER_URL}/product-validate-stock\" timeout=\"5000\"\nsoftTimeout=\"100\" priority=\"100\" required=\"true\" fallbackErrorMessage=\"The product stock valdiation failed\">\n                <headers>\n                    <header resolver=\"Magento\\\\WebhookModule\\\\Model\\\\AddProductToCartResolver\" />\n                </headers>\n                <fields>\n                    <field name='product.name' source='data.product.name' />\n                    <field name='product.category_ids' source='data.product.category_ids' />\n                    <field name='product.sku' source='data.product.sku' />\n                </fields>\n            </hook>\n        </batch>\n    </hooks>\n</method>\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Configured payload:`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n   \"product\" {\n        \"name\": \"string\",\n        \"category_ids\": \"string[]\",\n        \"sku\": \"string\"\n    }\n}\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}